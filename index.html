<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides a set of tools to assist statistical programmers 
    in validating Study Data Tabulation Model (SDTM) domain data sets. 
    Statistical programmers are required to validate that a SDTM data set domain 
    has been programmed correctly, per the SDTM Implementation Guide (SDTMIG), 
    study specification, and study protocol using a process called double 
    programming. Double programming involves two different programmers 
    independently converting the raw electronic data cut (EDC) data into a SDTM 
    domain data table and comparing their results to ensure accurate 
    standardization of the data. One of these attempts is termed production 
    and the other validation. Generally, production runs are the official 
    programs for submittals and these are written in SAS. Validation runs can be 
    programmed in another language, in this case R. ">
<title>Validate SDTM Domains • sdtmval</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Validate SDTM Domains">
<meta property="og:description" content="Provides a set of tools to assist statistical programmers 
    in validating Study Data Tabulation Model (SDTM) domain data sets. 
    Statistical programmers are required to validate that a SDTM data set domain 
    has been programmed correctly, per the SDTM Implementation Guide (SDTMIG), 
    study specification, and study protocol using a process called double 
    programming. Double programming involves two different programmers 
    independently converting the raw electronic data cut (EDC) data into a SDTM 
    domain data table and comparing their results to ensure accurate 
    standardization of the data. One of these attempts is termed production 
    and the other validation. Generally, production runs are the official 
    programs for submittals and these are written in SAS. Validation runs can be 
    programmed in another language, in this case R. ">
<meta property="og:image" content="https://skgithub14.github.io/sdtmval/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">sdtmval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/dates.html">Dates</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/skgithub14/sdtmval/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="sdtmval-">sdtmval 
<a class="anchor" aria-label="anchor" href="#sdtmval-"></a>
</h1>
</div>
<!-- badges: start -->

<!-- badges: end -->
<p>{sdtmval} provides a set of tools to assist statistical programmers in validating Study Data Tabulation Model (SDTM) domain data sets.</p>
<p>Many data cleaning steps and SDTM processes are used repeatedly in different SDTM domain validation scripts. Functionalizing these repetitive tasks allows statistical programmers to focus on coding the unique aspects of a SDTM domain while standardize their code base across studies and domains. This should lead to fewer bugs and improved code readability too. {sdtmval} features include:</p>
<ul>
<li><p>Automating the BLFL, DY, EPOCH, SEQ, and STAT methods to create new variables</p></li>
<li><p>Imputing and formatting full and partial dates: see <a href="https://skgithub14.github.io/sdtmval/articles/dates.html"><code>vignette("Dates")</code></a></p></li>
<li><p>Applying specification data such as variable labels, lengths, code mapping, and sorting</p></li>
<li><p>Importing EDC and SDTM data from .csv and .sas7bdat files</p></li>
<li><p>Writing .xpt files (convenience wrapper for <code><a href="https://haven.tidyverse.org/reference/read_xpt.html" class="external-link">haven::write_xpt()</a></code>)</p></li>
<li><p>Converting .Rmd files to .R scripts (convenience wrapper for <code><a href="https://rdrr.io/pkg/knitr/man/knit.html" class="external-link">knitr::purl()</a></code>)</p></li>
<li><p>Logging R session information for reproducibility</p></li>
<li><p>Data formatting</p></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the release version of {sdtmval} from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"sdtmval"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of {sdtmval} from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"skgithub14/sdtmval"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<hr>
</div>
<div class="section level2">
<h2 id="a-typical-work-flow-example">A typical work flow example<a class="anchor" aria-label="anchor" href="#a-typical-work-flow-example"></a>
</h2>
<p>In this example work flow, we will import a raw EDC table and transform it into a SDTM domain table. We will use the made-up domain ‘XX’ along with some example data included in {sdtmval}.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set-up</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/skgithub14/sdtmval" class="external-link">sdtmval</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="st">"XX"</span></span>
<span></span>
<span><span class="co"># set working directory to location of sdtmval package example data</span></span>
<span><span class="va">work_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"sdtmval"</span><span class="op">)</span></span></code></pre></div>
<p>The majority of the data needed is in the EDC form/table xx.csv. There are also visit dates in the EDC table vd.csv and study start/end dates in the SDTM table dm.sas7dbat. These can be imported using <code><a href="reference/read_edc_tbls.html">read_edc_tbls()</a></code> and <code><a href="reference/read_sdtm_tbls.html">read_sdtm_tbls()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in EDC tables from the forms XX and VD</span></span>
<span><span class="va">edc_tbls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"vd"</span><span class="op">)</span></span>
<span><span class="va">edc_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_edc_tbls.html">read_edc_tbls</a></span><span class="op">(</span><span class="va">edc_tbls</span>, dir <span class="op">=</span> <span class="va">work_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read in SDTM domain DM</span></span>
<span><span class="va">sdtm_tbls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dm"</span><span class="op">)</span></span>
<span><span class="va">sdtm_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_sdtm_tbls.html">read_sdtm_tbls</a></span><span class="op">(</span><span class="va">sdtm_tbls</span>, dir <span class="op">=</span> <span class="va">work_dir</span><span class="op">)</span></span></code></pre></div>
<p>The raw data looks like this:</p>
<table class="table">
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">XXTESTCD</th>
<th align="left">XXORRES</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 1</td>
<td align="left">   T1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 2</td>
<td align="left">   T1</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 3</td>
<td align="left">   T1</td>
<td align="left">    2</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 3</td>
<td align="left">   T2</td>
<td align="left">100</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 4</td>
<td align="left">   T3</td>
<td align="left">PASS   </td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 1</td>
<td align="left">   T1</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 2</td>
<td align="left">   T1</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 3</td>
<td align="left">   T1</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 3</td>
<td align="left">   T2</td>
<td align="left">200</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 4</td>
<td align="left">   T3</td>
<td align="left">       FAIL </td>
</tr>
</tbody>
</table>
<p>The next thing we will do is get the relevant information from the SDTM specification for the study. The next set of functions assumes there is a .xlsx file which contains the sheets: ‘Datasets’, ‘XX’, and ‘Codelists’:</p>
<ul>
<li><p>‘XX’ gives the variable information for the made-up XX domain. <code><a href="reference/get_data_spec.html">get_data_spec()</a></code> retrieves this entire tab.</p></li>
<li><p>‘Datasets’ contains the key variables by domain. <code><a href="reference/get_key_vars.html">get_key_vars()</a></code> retrieves the these for desired <code>domain</code>.</p></li>
<li><p>‘Codelists’ provides a table of coded/decoded values by variable for all domains. <code><a href="reference/get_codelist.html">get_codelist()</a></code> extracts a data frame of coded/decoded values from this sheet just for the variables in desired <code>domain</code>.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_fname</span> <span class="op">&lt;-</span> <span class="st">"spec.xlsx"</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_data_spec.html">get_data_spec</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="va">domain</span>, dir <span class="op">=</span> <span class="va">work_dir</span>, filename <span class="op">=</span> <span class="va">spec_fname</span><span class="op">)</span></span>
<span><span class="va">key_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_key_vars.html">get_key_vars</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="va">domain</span>, dir <span class="op">=</span> <span class="va">work_dir</span>, filename <span class="op">=</span> <span class="va">spec_fname</span><span class="op">)</span></span>
<span><span class="va">codelists</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_codelist.html">get_codelist</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="va">domain</span>, dir <span class="op">=</span> <span class="va">work_dir</span>, filename <span class="op">=</span> <span class="va">spec_fname</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="10%">
<col width="12%">
<col width="45%">
<col width="13%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">Order</th>
<th align="left">Dataset</th>
<th align="left">Variable</th>
<th align="left">Label</th>
<th align="left">Data Type</th>
<th align="right">Length</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">XX</td>
<td align="left">STUDYID</td>
<td align="left">Study Identifier</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">XX</td>
<td align="left">DOMAIN</td>
<td align="left">Domain Abbreviation</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">XX</td>
<td align="left">USUBJID</td>
<td align="left">Unique Subject Identifier</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">XX</td>
<td align="left">XXSEQ</td>
<td align="left">Sequence Number</td>
<td align="left">integer</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">XX</td>
<td align="left">XXTESTCD</td>
<td align="left">XX Test Short Name</td>
<td align="left">text</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">XX</td>
<td align="left">XXTEST</td>
<td align="left">XX Test Name</td>
<td align="left">text</td>
<td align="right">40</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">XX</td>
<td align="left">XXORRES</td>
<td align="left">Result or Finding in Original Units</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">XX</td>
<td align="left">XXBLFL</td>
<td align="left">Baseline Flag</td>
<td align="left">text</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">XX</td>
<td align="left">VISIT</td>
<td align="left">Visit Name</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">XX</td>
<td align="left">EPOCH</td>
<td align="left">Epoch</td>
<td align="left">text</td>
<td align="right">200</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">XX</td>
<td align="left">XXDTC</td>
<td align="left">Date/Time of Measurements</td>
<td align="left">datetime</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">XX</td>
<td align="left">XXDY</td>
<td align="left">Study Day of XX</td>
<td align="left">integer</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">codelists</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="left">Term</th>
<th align="left">Decoded Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">XXTESTCD</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
</tr>
<tr class="even">
<td align="left">XXTESTCD</td>
<td align="left">T2</td>
<td align="left">Test 2</td>
</tr>
<tr class="odd">
<td align="left">XXTESTCD</td>
<td align="left">T3</td>
<td align="left">Test 3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">key_vars</span></span>
<span><span class="co">#&gt; [1] "STUDYID"  "USUBJID"  "XXTESTCD" "VISIT"</span></span></code></pre></div>
<p>Now we will begin creating the SDTM XX domain using the EDC XX form as the basis.</p>
<p>First, it needs some pre-processing because there is extra white space in some of the variables. We also want to turn all NA equivalent values like <code>""</code> and <code>" "</code> to <code>NA</code> for the entire data set so we have consistent handling of missing values during data processing. The function <code><a href="reference/trim_and_make_blanks_NA.html">trim_and_make_blanks_NA()</a></code> does both of these tasks.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/trim_and_make_blanks_NA.html">trim_and_make_blanks_NA</a></span><span class="op">(</span><span class="va">edc_dat</span><span class="op">$</span><span class="va">xx</span><span class="op">)</span></span></code></pre></div>
<p>Next, using the codelist we retrieved earlier, we can create the <code>XXTEST</code> variable.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare the code list so it can be used by dplyr::recode() </span></span>
<span><span class="va">xxtestcd_codelist</span> <span class="op">&lt;-</span> <span class="va">codelists</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="st">"XXTESTCD"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Term</span>, <span class="va">`Decoded Value`</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">deframe</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create XXTEST variable</span></span>
<span><span class="va">sdtm_xx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sdtm_xx1</span>, XXTEST <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">XXTESTCD</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">xxtestcd_codelist</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">sdtm_xx2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">XXTESTCD</th>
<th align="left">XXORRES</th>
<th align="left">XXTEST</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 1</td>
<td align="left">T1</td>
<td align="left">1</td>
<td align="left">Test 1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 2</td>
<td align="left">T1</td>
<td align="left">0</td>
<td align="left">Test 1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 3</td>
<td align="left">T1</td>
<td align="left">2</td>
<td align="left">Test 1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 3</td>
<td align="left">T2</td>
<td align="left">100</td>
<td align="left">Test 2</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="left">Visit 4</td>
<td align="left">T3</td>
<td align="left">PASS</td>
<td align="left">Test 3</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 1</td>
<td align="left">T1</td>
<td align="left">1</td>
<td align="left">Test 1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 2</td>
<td align="left">T1</td>
<td align="left">NA</td>
<td align="left">Test 1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 3</td>
<td align="left">T1</td>
<td align="left">2</td>
<td align="left">Test 1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 3</td>
<td align="left">T2</td>
<td align="left">200</td>
<td align="left">Test 2</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="left">Visit 4</td>
<td align="left">T3</td>
<td align="left">FAIL</td>
<td align="left">Test 3</td>
</tr>
</tbody>
</table>
<p>In order to calculate the variables XXBLFL, EPOCH, and XXDY, we need the visit dates from the EDC VD table and the study start/end dates by subject from the SDTM DM table.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx3</span> <span class="op">&lt;-</span> <span class="va">sdtm_xx2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># get the VISITDTC column from the EDC VD form</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">edc_dat</span><span class="op">$</span><span class="va">vd</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"VISIT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># create the XXDTC variable</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>XXDTC <span class="op">=</span> <span class="va">VISITDTC</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># get the study start/end dates by subject (RFSTDTC, RFXSTDTC, RFXENDTC)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sdtm_dat</span><span class="op">$</span><span class="va">dm</span>, by <span class="op">=</span> <span class="st">"USUBJID"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can proceed with calculating those timing variables using the <code><a href="reference/create_BLFL.html">create_BLFL()</a></code>, <code><a href="reference/create_EPOCH.html">create_EPOCH()</a></code>, and <code><a href="reference/calc_DY.html">calc_DY()</a></code> functions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx4</span> <span class="op">&lt;-</span> <span class="va">sdtm_xx3</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># XXBLFL</span></span>
<span>  <span class="fu"><a href="reference/create_BLFL.html">create_BLFL</a></span><span class="op">(</span>sort_date <span class="op">=</span> <span class="st">"XXDTC"</span>,</span>
<span>              domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>              grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"XXTESTCD"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># EPOCH</span></span>
<span>  <span class="fu"><a href="reference/create_EPOCH.html">create_EPOCH</a></span><span class="op">(</span>date_col <span class="op">=</span> <span class="st">"XXDTC"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># XXDY</span></span>
<span>  <span class="fu"><a href="reference/calc_DY.html">calc_DY</a></span><span class="op">(</span>DY_col <span class="op">=</span> <span class="st">"XXDY"</span>, DTC_col <span class="op">=</span> <span class="st">"XXDTC"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># check the new variables and their related columns only</span></span>
<span><span class="va">sdtm_xx4</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">XXTEST</span>, <span class="va">XXORRES</span>, <span class="va">XXDTC</span>, <span class="va">XXBLFL</span>, </span>
<span>         <span class="va">EPOCH</span>, <span class="va">XXDY</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"RF"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="7%">
<col width="8%">
<col width="11%">
<col width="7%">
<col width="10%">
<col width="5%">
<col width="11%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">USUBJID</th>
<th align="left">XXTEST</th>
<th align="left">XXORRES</th>
<th align="left">XXDTC</th>
<th align="left">XXBLFL</th>
<th align="left">EPOCH</th>
<th align="right">XXDY</th>
<th align="left">RFSTDTC</th>
<th align="left">RFXSTDTC</th>
<th align="left">RFXENDTC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">Test 1</td>
<td align="left">1</td>
<td align="left">2023-08-01</td>
<td align="left">NA</td>
<td align="left">SCREENING</td>
<td align="right">-1</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-03</td>
</tr>
<tr class="even">
<td align="left">Subject 1</td>
<td align="left">Test 1</td>
<td align="left">0</td>
<td align="left">2023-08-02</td>
<td align="left">Y</td>
<td align="left">TREATMENT</td>
<td align="right">1</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-03</td>
</tr>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">Test 1</td>
<td align="left">2</td>
<td align="left">2023-08-03</td>
<td align="left">NA</td>
<td align="left">TREATMENT</td>
<td align="right">2</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-03</td>
</tr>
<tr class="even">
<td align="left">Subject 1</td>
<td align="left">Test 2</td>
<td align="left">100</td>
<td align="left">2023-08-03</td>
<td align="left">NA</td>
<td align="left">TREATMENT</td>
<td align="right">2</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-03</td>
</tr>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">Test 3</td>
<td align="left">PASS</td>
<td align="left">2023-08-04</td>
<td align="left">NA</td>
<td align="left">FOLLOW-UP</td>
<td align="right">3</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-02</td>
<td align="left">2023-08-03</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">Test 1</td>
<td align="left">1</td>
<td align="left">2023-08-02</td>
<td align="left">Y</td>
<td align="left">SCREENING</td>
<td align="right">-1</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-04</td>
</tr>
<tr class="odd">
<td align="left">Subject 2</td>
<td align="left">Test 1</td>
<td align="left">NA</td>
<td align="left">2023-08-03</td>
<td align="left">NA</td>
<td align="left">TREATMENT</td>
<td align="right">1</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-04</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">Test 1</td>
<td align="left">2</td>
<td align="left">2023-08-04</td>
<td align="left">NA</td>
<td align="left">TREATMENT</td>
<td align="right">2</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-04</td>
</tr>
<tr class="odd">
<td align="left">Subject 2</td>
<td align="left">Test 2</td>
<td align="left">200</td>
<td align="left">2023-08-04</td>
<td align="left">NA</td>
<td align="left">TREATMENT</td>
<td align="right">2</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-04</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">Test 3</td>
<td align="left">FAIL</td>
<td align="left">2023-08-05</td>
<td align="left">NA</td>
<td align="left">FOLLOW-UP</td>
<td align="right">3</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-03</td>
<td align="left">2023-08-04</td>
</tr>
</tbody>
</table>
<p>Next, we will assign the sequence number using <code><a href="reference/assign_SEQ.html">assign_SEQ()</a></code> (which also sorts your data frame).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assign_SEQ.html">assign_SEQ</a></span><span class="op">(</span><span class="va">sdtm_xx4</span>, </span>
<span>                       key_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"XXTESTCD"</span>, <span class="st">"VISIT"</span><span class="op">)</span>,</span>
<span>                       seq_prefix <span class="op">=</span> <span class="va">domain</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check the new variable</span></span>
<span><span class="va">sdtm_xx5</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">XXTESTCD</span>, <span class="va">VISIT</span>, <span class="va">XXDTC</span>, <span class="va">XXSEQ</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">USUBJID</th>
<th align="left">XXTESTCD</th>
<th align="left">VISIT</th>
<th align="left">XXDTC</th>
<th align="right">XXSEQ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">T1</td>
<td align="left">Visit 1</td>
<td align="left">2023-08-01</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Subject 1</td>
<td align="left">T1</td>
<td align="left">Visit 2</td>
<td align="left">2023-08-02</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">T1</td>
<td align="left">Visit 3</td>
<td align="left">2023-08-03</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Subject 1</td>
<td align="left">T2</td>
<td align="left">Visit 3</td>
<td align="left">2023-08-03</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Subject 1</td>
<td align="left">T3</td>
<td align="left">Visit 4</td>
<td align="left">2023-08-04</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">T1</td>
<td align="left">Visit 1</td>
<td align="left">2023-08-02</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Subject 2</td>
<td align="left">T1</td>
<td align="left">Visit 2</td>
<td align="left">2023-08-03</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">T1</td>
<td align="left">Visit 3</td>
<td align="left">2023-08-04</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Subject 2</td>
<td align="left">T2</td>
<td align="left">Visit 3</td>
<td align="left">2023-08-04</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Subject 2</td>
<td align="left">T3</td>
<td align="left">Visit 4</td>
<td align="left">2023-08-05</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Now that the bulk of the data cleaning is complete, we will convert all date columns to character columns and all <code>NA</code> values to <code>""</code> so that our validation table matches the production table produced in SAS. To do this, we will use <code><a href="reference/format_chars_and_dates.html">format_chars_and_dates()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx6</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/format_chars_and_dates.html">format_chars_and_dates</a></span><span class="op">(</span><span class="va">sdtm_xx5</span><span class="op">)</span></span></code></pre></div>
<p>As a final step, we will assign the meta data from the spec to each column using <code><a href="reference/assign_meta_data.html">assign_meta_data()</a></code>. The meta data includes the labels for each column and their maximum allowed character lengths.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx7</span> <span class="op">&lt;-</span> <span class="va">sdtm_xx6</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># only keep columns that are domain variables and order them per the spec</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">spec</span><span class="op">$</span><span class="va">Variable</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># assign variable lengths and labels</span></span>
<span>  <span class="fu"><a href="reference/assign_meta_data.html">assign_meta_data</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="va">spec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show the final SDTM domain</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="11%">
<col width="7%">
<col width="10%">
<col width="8%">
<col width="9%">
<col width="8%">
<col width="9%">
<col width="11%">
<col width="12%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">USUBJID</th>
<th align="right">XXSEQ</th>
<th align="left">XXTESTCD</th>
<th align="left">XXTEST</th>
<th align="left">XXORRES</th>
<th align="left">XXBLFL</th>
<th align="left">VISIT</th>
<th align="left">EPOCH</th>
<th align="left">XXDTC</th>
<th align="right">XXDY</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="right">1</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left">1</td>
<td align="left"></td>
<td align="left">Visit 1</td>
<td align="left">SCREENING</td>
<td align="left">2023-08-01</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="right">2</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left">0</td>
<td align="left">Y</td>
<td align="left">Visit 2</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-02</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="right">3</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left">2</td>
<td align="left"></td>
<td align="left">Visit 3</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-03</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="right">4</td>
<td align="left">T2</td>
<td align="left">Test 2</td>
<td align="left">100</td>
<td align="left"></td>
<td align="left">Visit 3</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-03</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 1</td>
<td align="right">5</td>
<td align="left">T3</td>
<td align="left">Test 3</td>
<td align="left">PASS</td>
<td align="left"></td>
<td align="left">Visit 4</td>
<td align="left">FOLLOW-UP</td>
<td align="left">2023-08-04</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="right">1</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left">1</td>
<td align="left">Y</td>
<td align="left">Visit 1</td>
<td align="left">SCREENING</td>
<td align="left">2023-08-02</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="right">2</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Visit 2</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-03</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="right">3</td>
<td align="left">T1</td>
<td align="left">Test 1</td>
<td align="left">2</td>
<td align="left"></td>
<td align="left">Visit 3</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-04</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="right">4</td>
<td align="left">T2</td>
<td align="left">Test 2</td>
<td align="left">200</td>
<td align="left"></td>
<td align="left">Visit 3</td>
<td align="left">TREATMENT</td>
<td align="left">2023-08-04</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Study 1</td>
<td align="left">Subject 2</td>
<td align="right">5</td>
<td align="left">T3</td>
<td align="left">Test 3</td>
<td align="left">FAIL</td>
<td align="left"></td>
<td align="left">Visit 4</td>
<td align="left">FOLLOW-UP</td>
<td align="left">2023-08-05</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the meta data was assigned</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">[[</span><span class="va">.</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">[[</span><span class="va">.</span><span class="op">]</span><span class="op">]</span>, <span class="st">"width"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sdtm_xx7</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="va">labels</span>,</span>
<span>  lengths <span class="op">=</span> <span class="va">lengths</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      column                              labels lengths</span></span>
<span><span class="co">#&gt; 1   STUDYID                    Study Identifier     200</span></span>
<span><span class="co">#&gt; 2   USUBJID           Unique Subject Identifier     200</span></span>
<span><span class="co">#&gt; 3     XXSEQ                     Sequence Number       8</span></span>
<span><span class="co">#&gt; 4  XXTESTCD                  XX Test Short Name       8</span></span>
<span><span class="co">#&gt; 5    XXTEST                        XX Test Name      40</span></span>
<span><span class="co">#&gt; 6   XXORRES Result or Finding in Original Units     200</span></span>
<span><span class="co">#&gt; 7    XXBLFL                       Baseline Flag       1</span></span>
<span><span class="co">#&gt; 8     VISIT                          Visit Name     200</span></span>
<span><span class="co">#&gt; 9     EPOCH                               Epoch     200</span></span>
<span><span class="co">#&gt; 10    XXDTC           Date/Time of Measurements      19</span></span>
<span><span class="co">#&gt; 11     XXDY                     Study Day of XX       8</span></span></code></pre></div>
<p>Finally, we will write the SDTM XX domain validation table as a SAS transport file using <code><a href="reference/write_tbl_to_xpt.html">write_tbl_to_xpt()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/write_tbl_to_xpt.html">write_tbl_to_xpt</a></span><span class="op">(</span><span class="va">sdtm_xx7</span>, filename <span class="op">=</span> <span class="va">domain</span>, dir <span class="op">=</span> <span class="va">work_dir</span><span class="op">)</span></span></code></pre></div>
<p>For each previous steps, we viewed the interim results to demonstrate the features of {sdtmval} however, {sdtmval} is designed to be used with pipe operators so that you can have one long, readable pipe. To demonstrate, we will reproduce the same results from above in one code chunk.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdtm_xx</span> <span class="op">&lt;-</span> <span class="va">edc_dat</span><span class="op">$</span><span class="va">xx</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># pre-processing</span></span>
<span>  <span class="fu"><a href="reference/trim_and_make_blanks_NA.html">trim_and_make_blanks_NA</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># XXTEST</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>XXTEST <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">XXTESTCD</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">xxtestcd_codelist</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># get the VISITDTC column from the EDC VD form</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">edc_dat</span><span class="op">$</span><span class="va">vd</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"VISIT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># XXDTC</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>XXDTC <span class="op">=</span> <span class="va">VISITDTC</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># get the study start/end dates by subject (RFSTDTC, RFXSTDTC, RFXENDTC)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sdtm_dat</span><span class="op">$</span><span class="va">dm</span>, by <span class="op">=</span> <span class="st">"USUBJID"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># XXBLFL</span></span>
<span>  <span class="fu"><a href="reference/create_BLFL.html">create_BLFL</a></span><span class="op">(</span>sort_date <span class="op">=</span> <span class="st">"XXDTC"</span>,</span>
<span>              domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>              grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"XXTESTCD"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># EPOCH</span></span>
<span>  <span class="fu"><a href="reference/create_EPOCH.html">create_EPOCH</a></span><span class="op">(</span>date_col <span class="op">=</span> <span class="st">"XXDTC"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># XXDY</span></span>
<span>  <span class="fu"><a href="reference/calc_DY.html">calc_DY</a></span><span class="op">(</span>DY_col <span class="op">=</span> <span class="st">"XXDY"</span>, DTC_col <span class="op">=</span> <span class="st">"XXDTC"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># XXSEQ</span></span>
<span>  <span class="fu"><a href="reference/assign_SEQ.html">assign_SEQ</a></span><span class="op">(</span>key_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"XXTESTCD"</span>, <span class="st">"VISIT"</span><span class="op">)</span>,</span>
<span>             seq_prefix <span class="op">=</span> <span class="va">domain</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># final formatting</span></span>
<span>  <span class="fu"><a href="reference/format_chars_and_dates.html">format_chars_and_dates</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">spec</span><span class="op">$</span><span class="va">Variable</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/assign_meta_data.html">assign_meta_data</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="va">spec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check if the two data frames are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">sdtm_xx</span>, <span class="va">sdtm_xx7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/skgithub14/sdtmval/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/skgithub14/sdtmval/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sdtmval</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Stephen Knapp <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-5101-4555" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/skgithub14/sdtmval/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/skgithub14/sdtmval/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/skgithub14/sdtmval?branch=master" class="external-link"><img src="https://codecov.io/gh/skgithub14/sdtmval/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stephen Knapp.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
